<!docTYPE html>



<!-- WARNING ! No bundle basename must be define. Otherwise fmt:message does not work -->
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Signature sécurisé en ligne</title>

        <link rel="stylesheet" type="text/css" href="css/common.css" />
        <link rel="stylesheet" type="text/css" href="css/scenario4.css" />

        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>

        
        
            
            
                
                <script type="text/javascript">
                    $(document).ready(function(){
                        var stringBuffer = [];
                        stringBuffer.push('            <iframe id="iframe-popup" width="100%" height="100%">');
                        stringBuffer.push('                [Your browser does <em>not</em> support <code>iframe</code>]');
                        stringBuffer.push('            </iframe>');
                        $('#popup').append(stringBuffer.join(''));
                    });

                    function injectViewer(begin_url, url, end_url) {
                        var iframe = $('#iframe-popup');
                        $(iframe).attr('src', begin_url + url + end_url);
                    }
                </script>
                
            
        
        

        <!--  Images & Consent management -->
        <script type="text/javascript">
            var tabViewedDocuments=new Array;
            
                
            
                
                    tabViewedDocuments['appendix2.pdf']=false;
                
            
                
                    tabViewedDocuments['contract.pdf']=false;
                
            

            function documentViewed(id) {
                document.getElementById(id).className = 'documentViewed';
                tabViewedDocuments[id]=true;
                areAllDocumentsViewed();
            }

            function areAllDocumentsViewed() {
                for (var valeur in tabViewedDocuments) {
                    if(!tabViewedDocuments[valeur]) {
                        if(!document.getElementById("consentCheckBox").disabled){
                            document.getElementById("consentCheckBox").disabled=true;
                        }
                        return;
                    }
                }
                if(document.getElementById("consentCheckBox").disabled){
                    document.getElementById("consentCheckBox").disabled=false;
                }
            }
        </script>
        <!--  end Images & Consent management -->

        <!--  GWT: import JS-->
        <script type="text/javascript" src="js/dtp.nocache.js"></script>

        <!--  GWT dico -->
        <script type="text/javascript">
            var dtpGwtDico = {
                widget: "SignPanel",
                forceCheckBoxEnable : "false",
                authentication: "true"
            };

            // callBack on popup post hide
            function popupPostHide() {
                $('#mainContainer').removeClass("opacity");
            };

            // callBack on popup pre show
            function popupPreShow() {
                $('#mainContainer').addClass("opacity");
            };

            function onSignButtonClicked() {
                if(true) {
                    showOtpPanel();
                } else {
                    submitSignForm();
                }
            }

            function submitSignForm() {
                showLoadingPanel();
                document.forms["signForm"].submit();
            }

            $(document).ready(function(){
                // Pop Up
                $('a.poplight[href^=#]').click(function() {
                    var popID = $(this).attr('rel');
                    var popURL = $(this).attr('href');
                    var id = $(this).attr('id');



                    var query= popURL.split('?');
                    var dim= query[1].split('&');
                    var popWidth = dim[0].split('=')[1];

                    var url = dim[1].split('=')[1];
                    var end_url = "#toolbar=0&statusbar=0&navpanes=0&messages=0&1363793267742";
                    var begin_url = "";
                    //test
                    var id = dim[2].split('=')[1];
                    documentViewed(id);

                    // inject Acrobat Reader or Dictao DocViewer.
                    // Be aware that Dictao DocViewer remove all child of the popup div,
                    // so we have to inject it before prepending the close button
                    injectViewer(begin_url, url, end_url);

                    $('#' + popID).fadeIn().css({ 'width': Number( popWidth ) }).prepend('<a href="#" class="close"><div class="btn_close"></div></a>');

                    var popMargTop = ($('#' + popID).height() + 80) / 2;
                    var popMargLeft = ($('#' + popID).width() + 80) / 2;

                    //Apply Margin to Popup
                    $('#' + popID).css({
                        'margin-top' : -popMargTop,
                        'margin-left' : -popMargLeft
                    });

                    //Fade in Background
                    $('body').append('<div id="fade"></div>');
                    $('#fade').css({'filter' : 'alpha(opacity=80)'}).fadeIn();
                    return false;
                });

                //Close Popups and Fade Layer
                $('a.close, #fade').live('click', function() {
                    $('#fade , .popup_block').fadeOut(function() {
                        $('#fade, a.close').remove();
                    });
                    return false;
                });

            });
        </script>

    </head>
    <!--[if IE 6 ]><body class="ie6 ie"><![endif]-->
    <!--[if IE 7 ]><body class="ie7 ie"><![endif]-->
    <!--[if IE 8 ]><body class="ie8 ie"><![endif]-->
    <!--[if IE 9 ]><body class="ie9 ie"><![endif]-->

    <!--[if !IE]>--><body class="notie" onLoad="javascript:areAllDocumentsViewed()"><!--<![endif]-->

        <div id="mainContainer">
            <div class="container">
                <!-- RECOMMENDED if your web app will not function without JavaScript enabled -->
                <noscript>
                    <p class="warning" align="center">
                        Votre navigateur doit avoir JavaScript d'activé pour que cette application s'affiche correctement
                    </p>
                </noscript>

                <div id="header">
                    <div class="logo"></div>
                    <div class="titre">Signature sécurisé en ligne</div>
                </div>

                

                <div class="legal">
                    <!----------- BUSINESS ----------->
                    <div class="textBlock">
                        <!----------- IDENTITY ----------->
                        <h2>
                            Monsieur John Smith,
                        </h2>
                        <!----------- BUSINESS ----------->
                        <div class="reference">
                            Référence : LDD n° 1234
                        </div>
                        <br>
                        Vous êtes sur le point de finaliser votre souscription à votre assurance en suivant les étapes ci-dessous :
                    </div>
                    <!----------- SECOND STEP ----------->
                    <div class="textBlock">
                        <h4>Récapitulatif de vos documents à signer</h4>
                        Je clique sur chacun des documents ci-dessous pour prendre connaissance des pièces du dossier: <br>Pour pouvoir finaliser la signature, je prends connaissance des éléments obligatoires du dossier
                        <ul>
                            
                                
                                <li>
                                        
                                            
                                            
                                            
                                            <a href="#?w=700&url=appendix1.pdf&id=appendix1.pdf" rel="popup" class="poplight">
                                                <div class="documentInfo"><div id="appendix1.pdf" class="documentByDefault" ></div>
                                                Questionnaire de santé</div>
                                            </a>
                                            
                                        

                                </li>

                            
                                
                                <li>
                                        
                                            
                                            
                                            <a href="#?w=700&url=appendix2.pdf&id=appendix2.pdf" rel="popup" class="poplight">
                                                <div class="documentInfo"><div id="appendix2.pdf" class="documentMandatory" ></div>
                                                Conditions générales</div>
                                            </a>
                                            
                                            
                                        

                                </li>

                            
                                
                                <li>
                                        
                                            
                                            
                                            <a href="#?w=700&url=contract.pdf&id=contract.pdf" rel="popup" class="poplight">
                                                <div class="documentInfo"><div id="contract.pdf" class="documentMandatory" ></div>
                                                Demande d'adhésion</div>
                                            </a>
                                            
                                            
                                        

                                </li>

                            
                        </ul>
                    </div>
                    <!----------- THIRD STEP ----------->
                    <form id="signForm" method="post" action="signature">
                        <input type="hidden" name="otpInput" id="otpInput" class="text" size="6" maxlength="6" />
                        <input type="hidden" name="currentPage" id="currentPage" class="text" value="signature" />
                        <div class="textBlock">
                            <h4>Je donne mon consentement</h4>
                            Aprés avoir  signifié votre consentement en cochant la case ci-dessous, vous pourrez signer électroniquement vos documents en cliquant sur "Signer".<br><br>
                            <div class="reference">
                                <input id="consentCheckBox" type="checkbox" name="consentCheckBox" value="true" disabled/>
                                En cochant cette case, je reconnais que :
                            </div>
                            <ul>J'ai bien lu le contrat ci-contre que j'accepte de signer selon les termes et conditions de la politique de signature dont j'ai pris connaissance. J'ai connaissance du fait que la signature du contrat au moyen d'une signature &#233;lectronique manifeste mon consentement aux droits et obligations qui en d&#233;coulent, au m&#234;me titre qu'une signature manuscrite. J'accepte les <a href="blugin/termsAndConditions_fr.pdf" target="_blank">Conditions Générales</a>.</ul>
                            <div class="bottom_button">
                                <button class="an_btn" type="button" onclick="location.href='cancel'">
                                    Annuler
                                </button>
                                <button id="signButton" class="va_btn" type="button" onclick="onSignButtonClicked();">
                                    Signer
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- OTP Popup Panel -->
        <div id="otpPopupPanel" class="legal textBlock popup_otp" style="height: 185px; width: 310px; display:none;">
            <h2>Vous devez vous authentifier pour déclencher la signature</h2>
            <br>
            <div class="textInner">Veuillez renseigner le code d'authentification que vous avez reçu par SMS.</div>
            <label for="otpInputPopup" class="strong gray">Votre code SMS :</label>
            <input type="password" name="otpInputPopup" id="otpInputPopup" class="text" size="6" maxlength="6" />
            <div class="bottombutton_sign_pop_up">
                <button id="validateOtpButton" type="button" disabled>Valider</button>
                <button id="cancelOtpButton" class="an_btn" type="button">Annuler</button>
            </div>
        </div>

        <!-- LOADER -->
        <div id="loading" style="height: 75px; width: 200px; display:none">
            Chargement de la page...<br/>
            <div class="loader"></div>
        </div>

        <!-- DocViewer/AcrobatReader POPUP VIEW-->
        <div id="popup" style="height: 400px" class="popup_block">
        </div>

    </body>
</html>